<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ECG</title>
    <style>
        body {
            margin: 0;
            background: transparent;
        }
        canvas {
            display: block;
            background: #f4f4f4;
        }
    </style>
</head>
<body>

<canvas id="ecg" width="260" height="120"></canvas>

<script>
    const canvas = document.getElementById("ecg");
    const ctx = canvas.getContext("2d");

    const W = canvas.width;
    const H = canvas.height;

    // === VISUAL CONTROLS ===
    const BASELINE_OFFSET = 20;   // â†“ move ECG down (px)
    const GAIN = 1.9;             // ECG height
    const SPEED_DIV = 55;         // paper speed (bigger = slower)

    const MID = H / 2 + BASELINE_OFFSET;

    // scrolling buffer
    let buffer = new Array(W).fill(MID);

    let ecgP = 0;
    let heartRate = 80;

    // ECG morphology (dashboard-equivalent)
    const signal = {
        ecgAmp: 32,
        ecgSharp: 22,
        ecgNoise: 0.8
    };

    function ecgSample(x) {
        const qrs = Math.exp(-Math.pow(x - 30, 2) / signal.ecgSharp) * signal.ecgAmp;
        const s   = -Math.exp(-Math.pow(x - 36, 2) / (signal.ecgSharp * 1.4)) * (signal.ecgAmp / 3);
        const pW  =  Math.exp(-Math.pow(x - 18, 2) / (signal.ecgSharp * 3.0)) * (signal.ecgAmp / 8);
        const tW  =  Math.exp(-Math.pow(x - 55, 2) / (signal.ecgSharp * 2.5)) * (signal.ecgAmp / 6);
        const noise = (Math.random() - 0.5) * signal.ecgNoise;
        return (qrs + s + pW + tW + noise) * GAIN;
    }

    function step() {
        ctx.clearRect(0, 0, W, H);

        // slower scrolling (paper speed)
        ecgP += heartRate / SPEED_DIV;

        const sample = ecgSample(ecgP % 80);
        const y = MID - sample;

        buffer.push(y);
        buffer.shift();

        ctx.beginPath();
        ctx.strokeStyle = "#e11d48";
        ctx.lineWidth = 2;

        for (let i = 0; i < buffer.length; i++) {
            if (i === 0) ctx.moveTo(i, buffer[i]);
            else ctx.lineTo(i, buffer[i]);
        }

        ctx.stroke();
        requestAnimationFrame(step);
    }

    // === Java hook ===
    function setHeartRate(hr) {
        heartRate = hr;
    }

    step();
</script>

</body>
</html>
